// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model User {
  id             String   @id @default(cuid())
  studentId      String   @unique @map("student_id")
  name           String
  nickname       String?
  contact        String?
  password       String?
  role           String   @default("æœªè®¤è¯ç”¨æˆ·")
  status         String   @default("æ­£å¸¸")
  avatar         String?
  activationCode String?  @map("activation_code")
  resetCode      String?  @map("reset_code")
  resetCodeExpiresAt DateTime? @map("reset_code_expires_at")
  createdAt      DateTime @default(now()) @map("created_at")
  updatedAt      DateTime @updatedAt @map("updated_at")
  deleted        Boolean  @default(false)

  // å…³è”å…³ç³»
  products       Product[]
  comments       Comment[]
  favorites      Favorite[]
  sentMessages   Message[] @relation("SentMessages")
  receivedMessages Message[] @relation("ReceivedMessages")
  reports        Report[]
  notifications  Notification[]

  @@map("users")
}

model Category {
  id          String    @id @default(cuid())
  name        String    @unique
  description String?
  icon        String?   @default("ğŸ“")
  isActive    Boolean   @default(true) @map("is_active")
  isDefault   Boolean   @default(false) @map("is_default")
  sortOrder   Int       @default(0) @map("sort_order")
  createdAt   DateTime  @default(now()) @map("created_at")
  updatedAt   DateTime  @updatedAt @map("updated_at")
  deleted     Boolean   @default(false)

  // å…³è”å…³ç³»
  products    Product[]

  @@map("categories")
}

model Product {
  id          String    @id @default(cuid())
  name        String
  description String?   @db.Text
  price       Decimal   @db.Decimal(10, 2)
  categoryId  String    @map("category_id")
  sellerId    String    @map("seller_id")
  contact     String?
  status      String    @default("åœ¨å”®")
  images      String?   @db.Text // JSONæ ¼å¼å­˜å‚¨å›¾ç‰‡URLs
  viewCount   Int       @default(0) @map("view_count")
  soldAt      DateTime? @map("sold_at")
  createdAt   DateTime  @default(now()) @map("created_at")
  updatedAt   DateTime  @updatedAt @map("updated_at")
  deleted     Boolean   @default(false)

  // å…³è”å…³ç³»
  category    Category   @relation(fields: [categoryId], references: [id])
  seller      User       @relation(fields: [sellerId], references: [id])
  comments    Comment[]
  favorites   Favorite[]
  reports     Report[]

  @@map("products")
}

model Comment {
  id        String   @id @default(cuid())
  productId String   @map("product_id")
  userId    String   @map("user_id")
  content   String   @db.Text
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")
  deleted   Boolean  @default(false)

  // å…³è”å…³ç³»
  product   Product  @relation(fields: [productId], references: [id])
  user      User     @relation(fields: [userId], references: [id])

  @@map("comments")
}

model Favorite {
  id        String   @id @default(cuid())
  userId    String   @map("user_id")
  productId String   @map("product_id")
  createdAt DateTime @default(now()) @map("created_at")

  // å…³è”å…³ç³»
  user      User     @relation(fields: [userId], references: [id])
  product   Product  @relation(fields: [productId], references: [id])

  @@unique([userId, productId])
  @@map("favorites")
}

model Message {
  id         String   @id @default(cuid())
  senderId   String   @map("sender_id")
  receiverId String   @map("receiver_id")
  content    String   @db.Text
  isRead     Boolean  @default(false) @map("is_read")
  sentAt     DateTime @default(now()) @map("sent_at")
  deleted    Boolean  @default(false)

  // å…³è”å…³ç³»
  sender     User     @relation("SentMessages", fields: [senderId], references: [id])
  receiver   User     @relation("ReceivedMessages", fields: [receiverId], references: [id])

  @@map("messages")
}

model Notification {
  id        String   @id @default(cuid())
  userId    String   @map("user_id")
  title     String
  content   String   @db.Text
  type      String   // é€šçŸ¥ç±»å‹ï¼šç³»ç»Ÿé€šçŸ¥ã€äº¤æ˜“é€šçŸ¥ç­‰
  isRead    Boolean  @default(false) @map("is_read")
  createdAt DateTime @default(now()) @map("created_at")
  deleted   Boolean  @default(false)

  // å…³è”å…³ç³»
  user      User     @relation(fields: [userId], references: [id])

  @@map("notifications")
}

model Report {
  id        String   @id @default(cuid())
  reporterId String  @map("reporter_id")
  productId String?  @map("product_id")
  reason    String
  content   String?  @db.Text
  status    String   @default("å¾…å¤„ç†") // å¾…å¤„ç†ã€å·²å¤„ç†ã€å·²é©³å›
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")
  deleted   Boolean  @default(false)

  // å…³è”å…³ç³»
  reporter  User     @relation(fields: [reporterId], references: [id])
  product   Product? @relation(fields: [productId], references: [id])

  @@map("reports")
}

model Notice {
  id        String   @id @default(cuid())
  title     String
  content   String   @db.Text
  type      String   @default("ç³»ç»Ÿå…¬å‘Š")
  isActive  Boolean  @default(true) @map("is_active")
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")
  deleted   Boolean  @default(false)

  @@map("notices")
} 